#!/usr/bin/env python
# -*- coding: utf-8 -*-
#
#       kazam
#       
#       Copyright 2010 Andrew <andrew@karmic-desktop>
#       
#       This program is free software; you can redistribute it and/or modify
#       it under the terms of the GNU General Public License as published by
#       the Free Software Foundation; either version 2 of the License, or
#       (at your option) any later version.
#       
#       This program is distributed in the hope that it will be useful,
#       but WITHOUT ANY WARRANTY; without even the implied warranty of
#       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#       GNU General Public License for more details.
#       
#       You should have received a copy of the GNU General Public License
#       along with this program; if not, write to the Free Software
#       Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
#       MA 02110-1301, USA.

# Check if we are working in the source tree or from the installed 
# package and mangle the python path accordingly

import pygtk
pygtk.require("2.0")
import gtk
gtk.gdk.threads_init()

from optparse import OptionParser
import gettext
import logging
import os
import sys

if os.path.exists("../data/ui/start.ui"):
    (head, tail) = os.path.split(os.getcwd())
    sys.path.insert(0, os.path.abspath(head))

from kazam.version import *

if __name__ == "__main__":

    parser = OptionParser("usage: %prog [options] package", 
                          version="%prog "+VERSION)
    parser.add_option("--debug", action="store_true",
                      help="enable debug mode", default=False)
    parser.add_option("--force-rtl", action="store_true",
                      help="force rtl mode (useful for debugging)", 
                      default=False)  
    (options, args) = parser.parse_args()
        
    if options.debug:
        logging.basicConfig(level=logging.DEBUG)
    else:
        logging.basicConfig(level=logging.INFO)
    
    # override text direction for testing purposes
    if options.force_rtl:
        gtk.widget_set_default_direction(gtk.TEXT_DIR_RTL)

    if os.path.exists("../data/ui/start.ui"):
        logging.info("Running locally")
        datadir = "../data"
    else:
        # A bit flexible setting of datadir, it takes care
        # when base install path is not /usr
        curpath = os.path.abspath(__file__)
        datadir = curpath.split('bin/')[0] + "share/kazam/"


    from kazam.app import KazamApp
    
    app = KazamApp(datadir)
    app.run()
